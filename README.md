# JSON-to-Go Converter

A Go implementation of the JSON-to-Go converter, originally created by Matt Holt. This tool converts JSON to Go struct definitions with proper field tags.

## Quick Start

```bash
# Build the tool
make build

# Try it out with the example file
make run

# Or pipe JSON directly
echo '{"name":"John","age":30}' | ./json-to-go -type=Person
```

## Installation

### Using Make (Recommended)

```bash
git clone https://github.com/filipjaj/json-to-go.git
cd json-to-go
make build
```

### Build from source

```bash
git clone https://github.com/filipjaj/json-to-go.git
cd json-to-go
go build -o json-to-go ./cmd/json-to-go
```

### Install with go install

```bash
go install github.com/filipjaj/json-to-go/cmd/json-to-go@latest
```

## CLI Usage

> ⚠️ **IMPORTANT:** All flags must come **BEFORE** the file or URL argument!
>
> ✅ Correct: `./json-to-go -type=User -output=file.go data.json`  
> ❌ Wrong: `./json-to-go data.json -type=User -output=file.go`

### From stdin

```bash
echo '{"name":"John","age":30}' | ./json-to-go -type=Person
```

### From file

```bash
./json-to-go -type=APIResponse example.json
```

### From URL

```bash
# URL as positional argument
./json-to-go -type=User https://api.example.com/users/1

# URL as flag
./json-to-go -url=https://api.example.com/data -type=Response

# Fetch from URL and save to file
./json-to-go -type=Post -output=types.go https://jsonplaceholder.typicode.com/posts/1
```

### Write to file

```bash
# From file to file
./json-to-go -type=User -output=user_types.go example.json

# From stdin to file
echo '{"name":"John"}' | ./json-to-go -type=Person -output=person.go

# From URL to file
./json-to-go -url=https://api.example.com/data -output=structs.go -type=Data
```

### With options

```bash
# Add omitempty to all fields
echo '{"name":"John"}' | ./json-to-go -type=Person -omitempty

# Include example tags
./json-to-go -type=User -example data.json

# Combine options
./json-to-go -type=User -omitempty -output=user.go https://api.example.com/user

# Show help
./json-to-go -help
```

### Available Options

- `-type string` - Name for the generated type (default "AutoGenerated")
- `-output string` - Output file path (default: stdout)
- `-url string` - Fetch JSON from URL
- `-flatten` - Flatten nested types to top-level declarations (default true)
- `-example` - Include example tags
- `-omitempty` - Add omitempty to all fields
- `-help` - Show help message

## Features

### Core Functionality

- ✅ Converts JSON to Go struct definitions
- ✅ Handles nested objects and arrays
- ✅ Detects proper Go types (int, int64, float64, bool, string, time.Time)
- ✅ Supports common Go initialisms (ID, URL, HTTP, API, etc.)
- ✅ Generates proper JSON tags
- ✅ Optional `omitempty` tags for optional fields
- ✅ Optional `example` tags
- ✅ Handles edge cases (null values, mixed types, special characters)
- ✅ Flatten mode for top-level struct definitions

### Input Sources

- ✅ **Stdin** - Pipe JSON directly from command line
- ✅ **Local files** - Read from JSON files
- ✅ **URLs** - Fetch JSON directly from HTTP/HTTPS endpoints
- ✅ **Auto-detection** - Automatically detects if input is URL or file

### Output Options

- ✅ **Stdout** - Print to console (default)
- ✅ **File** - Write to specified Go file with `-output` flag

### Quality

- ✅ 78.6% test coverage with comprehensive tests
- ✅ Race condition tested
- ✅ Full CLI with help documentation

## Usage

```go
package main

import (
    "fmt"
    jsontogo "github.com/filipjaj/json-to-go"
)

func main() {
    json := `{
        "user_id": 12345,
        "username": "john_doe",
        "email": "john@example.com",
        "created_at": "2023-10-15T12:30:45Z"
    }`

    result := jsontogo.JSONToGo(json, "User", true, false, false)

    if result.Error != "" {
        fmt.Println("Error:", result.Error)
        return
    }

    fmt.Println(result.Go)
}
```

### Output

```go
type User struct {
    UserID int `json:"user_id"`
    Username string `json:"username"`
    Email string `json:"email"`
    CreatedAt time.Time `json:"created_at"`
}
```

## API

### JSONToGo Function

```go
func JSONToGo(jsonInput string, typename string, flatten, example, allOmitempty bool) Result
```

**Parameters:**

- `jsonInput`: JSON string to convert
- `typename`: Name for the root type
- `flatten`: Whether to flatten nested types to top-level declarations
- `example`: Include example tags with sample values
- `allOmitempty`: Add omitempty to all fields

**Returns:**

- `Result` struct with `Go` (string) and `Error` (string) fields

## Type Detection

The converter automatically detects:

- **Integers**: Small integers become `int`, large ones become `int64`
- **Floats**: Numbers with decimals become `float64`
- **Booleans**: `true`/`false` become `bool`
- **Timestamps**: ISO 8601 timestamps become `time.Time`
- **Null values**: Null becomes `any`
- **Objects**: JSON objects become nested structs
- **Arrays**: JSON arrays become Go slices

## Special Features

### Common Initialisms

Follows Go conventions for common initialisms:

- `user_id` → `UserID`
- `api_key` → `APIKey`
- `http_url` → `HTTPURL`

### Field Name Sanitization

- Removes special characters
- Handles numeric field names (e.g., `"123"` → `Num123`)
- Converts `SCREAMING_CASE` to `PascalCase`

### Optional Fields

When parsing arrays of objects, fields that don't appear in all objects get the `omitempty` tag automatically.

## Development

### Makefile Targets

The project includes a Makefile for common tasks:

```bash
make build          # Build the binary
make test           # Run all tests
make test-coverage  # Run tests with coverage report (generates coverage.html)
make test-race      # Run tests with race detection
make clean          # Remove build artifacts
make install        # Install to $GOPATH/bin
make run            # Run with example.json
make help           # Show available targets
```

## Testing

Run tests with:

```bash
go test -v
```

Run with coverage:

```bash
go test -cover
```

Run with race detection:

```bash
go test -race
```

## Test Coverage

The package includes comprehensive tests covering:

- Simple and nested objects
- Arrays and arrays of objects
- Mixed types and null values
- Timestamp detection
- Number type detection (int, int64, float64)
- Special characters in field names
- Common Go initialisms
- Omitempty tag generation
- Invalid JSON handling
- Edge cases (empty arrays, deep nesting, mixed arrays)

## Credits

Original JavaScript implementation by [Matt Holt](https://github.com/mholt/json-to-go)

Go implementation with comprehensive testing and continuous verification.
[![Go Reference](https://pkg.go.dev/badge/github.com/filipjaj/json-to-go@v0.0.0-20251016123751-aaf18061db9c.svg)](https://pkg.go.dev/github.com/filipjaj/json-to-go@v0.0.0-20251016123751-aaf18061db9c)
